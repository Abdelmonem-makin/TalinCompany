<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>المنتجات - تالين</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary"><div class="container-fluid"><a class="navbar-brand" href="index.html">تالين</a></div></nav>
  <main class="container py-4">
    <div class="d-flex justify-content-between mb-3"><h1 class="h4">إدارة المنتجات الدوائية</h1><a class="btn btn-primary" href="#" data-bs-toggle="modal" data-bs-target="#addProductModal">إضافة منتج</a></div>
    <div class="card p-3 mb-3">
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead><tr><th>اسم الدواء</th><th>الشركة المصنعة</th><th>التركيز</th><th>الشكل</th><th>فئة علاجية</th><th>الأصناف/الباتش</th><th>إجراءات</th></tr></thead>
          <tbody>
            <tr>
              <td>باراسيتامول</td><td>تالين</td><td>500 مجم</td><td>أقراص</td><td>مسكنات</td>
              <td>
                <ul class="mb-0">
                  <li>Batch: B123 - موجود: 200 - انتهاء: 2026-02-01 <span class="badge badge-expiry">180 أيام</span></li>
                  <li>Batch: B124 - موجود: 50 - انتهاء: 2025-11-20 <span class="badge badge-expiry text-danger">4 أيام</span></li>
                </ul>
              </td>
              <td><button class="btn btn-sm btn-outline-primary" data-sku="PARA500" data-barcode="123456789012" onclick="showBarcode(this)">باركود</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card p-3">
      <h6>تفاصيل باتشات المنتج</h6>
      <div id="batchTable" class="table-responsive">
        <table class="table table-sm">
          <thead><tr><th>Batch</th><th>SKU</th><th>كمية</th><th>تاريخ الإنتاج</th><th>تاريخ الانتهاء</th></tr></thead>
          <tbody>
            <tr><td>B123</td><td>PARA500</td><td>200</td><td>2024-08-01</td><td>2026-02-01</td></tr>
            <tr><td>B124</td><td>PARA500</td><td>50</td><td>2024-05-01</td><td>2025-11-20</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Barcode Modal -->
  <div class="modal fade" id="barcodeModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">عرض الباركود</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body text-center"><p id="barcodeValue" class="fw-bold"></p><svg id="barcodeSvg"></svg></div><div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button></div></div></div></div>

  <script>
    function showBarcode(btn){
      const code = btn.getAttribute('data-barcode') || btn.getAttribute('data-sku');
      document.getElementById('barcodeValue').textContent = code;
      // Generate SVG barcode using JsBarcode
      try{
        JsBarcode('#barcodeSvg', code, {format: 'EAN13', displayValue: true, height:60});
      } catch(e){
        // fallback: CODE128
        JsBarcode('#barcodeSvg', code, {format: 'CODE128', displayValue: true, height:60});
      }
      var bm = new bootstrap.Modal(document.getElementById('barcodeModal'));
      bm.show();
    }
  </script>
  
  <!-- Add Product Modal -->
  <div class="modal fade" id="addProductModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">إضافة منتج دوائي</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <form id="productForm">
            <div class="row g-2">
              <div class="col-md-6"><label class="form-label">اسم الدواء</label><input class="form-control" name="name" required></div>
              <div class="col-md-6"><label class="form-label">الشركة المصنعة</label><input class="form-control" name="manufacturer"></div>
              <div class="col-md-4"><label class="form-label">التركيز</label><input class="form-control" name="strength"></div>
              <div class="col-md-4"><label class="form-label">الشكل الصيدلاني</label><input class="form-control" name="form"></div>
              <div class="col-md-4"><label class="form-label">الفئة العلاجية</label><input class="form-control" name="therapeutic_class"></div>
              <div class="col-md-6"><label class="form-label">رقم التشغيلة (Batch No.)</label><input class="form-control" name="batch_no"></div>
              <div class="col-md-3"><label class="form-label">تاريخ الإنتاج</label><input class="form-control" type="date" name="production_date"></div>
              <div class="col-md-3"><label class="form-label">تاريخ الانتهاء</label><input class="form-control" type="date" name="expiry_date"></div>
              <div class="col-md-6"><label class="form-label">باركود داخلي</label><input class="form-control" name="internal_barcode"></div>
              <div class="col-md-6"><label class="form-label">باركود خارجي</label><input class="form-control" name="external_barcode"></div>
            </div>
          </form>
        </div>
        <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button><button id="saveProductBtn" class="btn btn-primary">حفظ</button></div>
      </div>
    </div>
  </div>

  <script>
    // Hook add product button
    document.querySelectorAll('.btn-primary').forEach(btn=>{
      if (btn.textContent && btn.textContent.includes('إضافة منتج')) btn.setAttribute('data-bs-toggle','modal'), btn.setAttribute('data-bs-target','#addProductModal');
    });
    document.getElementById('saveProductBtn').addEventListener('click', function(){
      const form = document.getElementById('productForm');
      if (!form.reportValidity()) return;
      console.log('Save product (demo):', Object.fromEntries(new FormData(form)));
      bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
      alert('تم حفظ المنتج (تجريبي)');
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
